@startuml A4_04_flow_analysis_simple
title Analysis Workflow (Simplified) â€“ Strategic Decision Flow

skinparam shadowing false
skinparam defaultFontName Arial
skinparam defaultFontSize 11

actor User
participant "LangGraph" as GRAPH
participant "Analysis API" as ANALYSIS
participant "Decision Hub" as DECISION
participant "Rules Engine" as RULES
participant "Scenario Engine" as SCENARIO
participant "RAG API" as RAG
database "Domain Data" as DB

== Start Analysis ==
User -> GRAPH : "Analyze enrollment trends"
GRAPH -> ANALYSIS : POST /analysis/workflows\n{type, context}
activate ANALYSIS
ANALYSIS -> DECISION : enqueue_workflow()
activate DECISION
DECISION --> ANALYSIS : workflow_id
deactivate DECISION
ANALYSIS --> GRAPH : {workflow_id, status: queued}
deactivate ANALYSIS
GRAPH --> User : "Analysis started..."

== Execute Workflow ==
DECISION -> RAG : retrieve context
RAG --> DECISION : historical data

DECISION -> DB : query university data
DB --> DECISION : baseline data

DECISION -> RULES : validate(data)
activate RULES
RULES --> DECISION : compliance result
deactivate RULES

DECISION -> SCENARIO : run_scenarios(baseline)
activate SCENARIO
par Scenario 1
  SCENARIO -> SCENARIO : current trend
else Scenario 2
  SCENARIO -> SCENARIO : increased capacity
else Scenario 3
  SCENARIO -> SCENARIO : reduced resources
end
SCENARIO --> DECISION : scenario results
deactivate SCENARIO

DECISION -> DB : save results
DECISION --> ANALYSIS : workflow complete

== Get Results ==
ANALYSIS --> GRAPH : results ready
GRAPH -> ANALYSIS : GET /workflows/{id}
ANALYSIS --> GRAPH : {findings, recommendations}
GRAPH --> User : "Analysis complete:\n[Summary]"

@enduml

