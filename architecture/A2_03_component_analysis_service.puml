@startuml A2_03_component_analysis_service
title Analysis Service â€“ Detailed Components

skinparam shadowing false
skinparam defaultFontName Arial
skinparam defaultFontSize 11
skinparam rectangle {
  BorderColor #000000
  BorderThickness 1
}

package "Analysis Service\nservices/analysis_api\nPort: 8090" as ANALYSIS_SERVICE {

package "API Layer" as API_LAYER {
  rectangle "Workflow API\n(/analysis/*)" as WORKFLOW_API
  rectangle "Rules API\n(/rules/*)" as RULES_API
  rectangle "Scenario API\n(/scenarios/*)" as SCENARIO_API
  rectangle "Optimization API\n(/optimization/*)" as OPTIM_API
}

package "Core Components" as CORE {
  rectangle "Decision Engine\nWorkflow orchestration & approvals" as DECISION
  rectangle "Rules Engine\nCompliance & policy validation" as RULES
  rectangle "Scenario Simulator\nParallel scenario execution" as SCENARIO
  rectangle "Optimizer\nStrategy generation & solving" as OPTIM
}

package "Infrastructure" as INFRA {
  rectangle "Task Queue\nCelery + Redis" as QUEUE
  rectangle "Distributed Compute\nRay cluster" as RAY
}

}

' External dependencies
database "Postgres" as DB
database "Redis" as REDIS
cloud "RAG Service" as RAG
cloud "Observability" as OBS

' API to components
WORKFLOW_API --> DECISION
RULES_API --> RULES
SCENARIO_API --> SCENARIO
OPTIM_API --> OPTIM

' Workflow orchestration
DECISION --> QUEUE : enqueue tasks
QUEUE --> RULES : compliance jobs
QUEUE --> SCENARIO : scenario runs
QUEUE --> OPTIM : optimization jobs

' Compute & storage
SCENARIO --> RAY : parallel execution
OPTIM --> RAY : distributed solving
DECISION --> DB : workflow state
RULES --> DB : validation results
SCENARIO --> DB : metrics
OPTIM --> DB : recommendations

' Context retrieval
SCENARIO --> RAG : baseline data
OPTIM --> RAG : historical context

' Observability
ANALYSIS_SERVICE --> OBS

note bottom of ANALYSIS_SERVICE
**Technology Stack:**
FastAPI + Celery + Ray + Redis + Postgres

**Key Features:**
- Long-running workflows
- Parallel execution
- Async task processing
- Horizontally scalable
end note

@enduml

